# DeCube Production Configuration
# This is a production-ready configuration template
# Copy and customize for your production environment

# Cluster configuration
cluster:
  id: "production-cluster-001"
  name: "Production Cluster"
  region: "us-east-1"
  
  # Local RAFT consensus
  raft:
    bind_addr: "0.0.0.0:7000"
    data_dir: "/var/lib/decube/raft"
    heartbeat_timeout: "500ms"
    election_timeout: "1s"
    snapshot_interval: "30s"
    snapshot_threshold: 1000
    max_append_entries: 100

# Global Consensus Layer (GCL)
gcl:
  enabled: true
  endpoints:
    - "gcl-node-1.internal:8080"
    - "gcl-node-2.internal:8080"
    - "gcl-node-3.internal:8080"
  timeout: "5s"
  retry_attempts: 3
  batch_size: 100
  batch_timeout: "100ms"

# Storage configuration
storage:
  # Content Addressable Storage
  cas:
    endpoint: "https://s3.amazonaws.com"
    access_key: "${CAS_ACCESS_KEY}"  # Use environment variable
    secret_key: "${CAS_SECRET_KEY}"  # Use environment variable
    bucket: "decube-cas-prod"
    region: "us-east-1"
    use_ssl: true
    chunk_size: 67108864  # 64MB
  
  # Object Storage (S3-compatible)
  object_storage:
    endpoint: "https://s3.amazonaws.com"
    access_key: "${OBJECT_STORAGE_ACCESS_KEY}"
    secret_key: "${OBJECT_STORAGE_SECRET_KEY}"
    bucket: "decube-objects-prod"
    region: "us-east-1"
    use_ssl: true

# Gossip protocol
gossip:
  enabled: true
  bind_addr: "0.0.0.0:8000"
  advertise_addr: ""  # Auto-detect
  peers:
    - "node-1.internal:8000"
    - "node-2.internal:8000"
    - "node-3.internal:8000"
  sync_interval: "5s"
  anti_entropy_interval: "30s"
  fanout: 3

# Catalog service
catalog:
  enabled: true
  bind_addr: "0.0.0.0:8080"
  data_dir: "/var/lib/decube/catalog"
  crdt_type: "orset"
  batch_size: 100
  compaction_interval: "1h"

# Snapshot service
snapshot:
  enabled: true
  chunk_size: 67108864  # 64MB
  compression: "lz4"    # Fast compression
  encryption: true
  retention_days: 90

# Security configuration
security:
  tls:
    enabled: true
    cert_file: "/etc/decube/tls/cert.pem"
    key_file: "/etc/decube/tls/key.pem"
    ca_file: "/etc/decube/tls/ca.pem"
    min_version: "1.3"
  
  key_rotation:
    enabled: true
    interval_days: 90
  
  authentication:
    enabled: true
    method: "jwt"
    jwt_secret: "${JWT_SECRET}"  # Use environment variable
    token_expiry: "24h"

# Logging
logging:
  level: "info"
  format: "json"
  output: "file"
  file: "/var/log/decube/decube.log"
  max_size: 100  # MB
  max_backups: 30
  max_age: 90  # days

# Metrics and monitoring
metrics:
  enabled: true
  bind_addr: "0.0.0.0:9090"
  path: "/metrics"
  
  prometheus:
    enabled: true
    endpoint: "http://prometheus:9090"
  
  tracing:
    enabled: true
    jaeger_endpoint: "http://jaeger:14268/api/traces"
    sample_rate: 0.1

# API server
api:
  rest:
    enabled: true
    bind_addr: "0.0.0.0:8080"
    read_timeout: "30s"
    write_timeout: "30s"
    idle_timeout: "120s"
    max_request_size: 10485760  # 10MB
  
  grpc:
    enabled: true
    bind_addr: "0.0.0.0:9090"
    max_recv_msg_size: 4194304  # 4MB
    max_send_msg_size: 4194304  # 4MB

# Performance tuning
performance:
  max_concurrent_requests: 1000
  request_timeout: "30s"
  connection_pool_size: 100
  worker_pool_size: 10
  cache_size: "1GB"
  cache_ttl: "5m"

# Backup configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention_days: 30
  destination: "s3://decube-backups-prod"
  encryption: true

# High availability
ha:
  enabled: true
  min_replicas: 3
  max_replicas: 10
  health_check_interval: "10s"
  failure_threshold: 3

